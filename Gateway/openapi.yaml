openapi: 3.0.0
info:
  title: Gateway API
  description: Point d'entrée principal pour l'architecture microservices du jeu Micro-Donjon. Orchestre les appels vers tous les services.
  version: 1.0.0

servers:
  - url: http://localhost:3000
    description: Serveur local de la Gateway

paths:
  # === HERO SERVICE ENDPOINTS ===
  /api/heroes:
    post:
      summary: Créer un nouveau héros
      tags:
        - Heroes
      requestBody:
        required: true
        content: 
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 50
      responses:
        '201':
          description: Héros créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '500':
          description: Erreur interne du serveur

    get:
      summary: Récupérer la liste de tous les héros
      tags:
        - Heroes
      responses:
        '200':
          description: Liste des héros
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Hero'
        '500':
          description: Erreur interne du serveur

  /api/heroes/{heroId}:
    get:
      summary: Récupérer un héros par son ID
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Détails du héros
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
  /api/heroes/{heroId}/health:
    put:
      summary: Mettre à jour les points de vie du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - healthPoints
              properties:
                healthPoints:
                  type: integer
      responses:
        '200':
          description: Points de vie mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
  /api/heroes/{heroId}/health-max:
    put:
      summary: Mettre à jour les points de vie max du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - healthPointsMax
              properties:
                healthPointsMax:
                  type: integer
      responses:
        '200':
          description: Points de vie max mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
  /api/heroes/{heroId}/level:
    put:
      summary: Mettre à jour le niveau du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - level
              properties:
                level:
                  type: integer
      responses:
        '200':
          description: Niveau mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
  /api/heroes/{heroId}/attack:
    put:
      summary: Mettre à jour les points d'attaque du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - attackPoints
              properties:
                attackPoints:
                  type: integer
      responses:
        '200':
          description: Points d'attaque mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
  /api/heroes/{heroId}/inventory:
    get:
      summary: Récupérer l'inventaire du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Inventaire du héros
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Item'
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur
    post:
      summary: Ajoute un objet à l'inventaire du héros
      tags:
        - Heroes
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - itemId
                - quantity
              properties:
                itemId:
                  type: string
                quantity:
                  type: integer
      responses:
        '200':
          description: Inventaire mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hero'
        '400':
          description: Données invalides
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur

  /api/heroes/classes:
    get:
      summary: Récupérer la liste de toutes les classes de héros
      tags:
        - Heroes
      responses:
        '200':
          description: Liste des classes de héros
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Class'
        '500':
          description: Erreur interne du serveur

  # === DUNGEON SERVICE ENDPOINTS ===
  /api/dungeons:
    post:
      summary: Créer un nouveau donjon
      tags:
        - Dungeons
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DungeonCreate'
      responses:
        '201':
          description: Donjon créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dungeon'
        '400':
          description: Données invalides
        '500':
          description: Erreur interne du serveur

    get:
      summary: Récupérer tous les donjons
      tags:
        - Dungeons
      responses:
        '200':
          description: Liste des donjons
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Dungeon'
        '500':
          description: Erreur interne du serveur

  /api/dungeons/{dungeonId}:
    get:
      summary: Récupérer un donjon par son ID
      tags:
        - Dungeons
      parameters:
        - name: dungeonId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Détails du donjon
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dungeon'
        '404':
          description: Donjon non trouvé
        '500':
          description: Erreur interne du serveur

  # === ITEM SERVICE ENDPOINTS ===
  /api/items:
    get:
      summary: Récupérer tous les  'items
      tags:
        - Items
      responses:
        '200':
          description: Liste des types d'items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Item'
        '500':
          description: Erreur interne du serveur

  /api/items/{itemId}:
    get:
      summary: Récupérer un item par son ID
      tags:
        - Items
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Détails d'un item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '404':
          description: Item non trouvé
        '500':
          description: Erreur interne du serveur
  /api/items/random:
    get:
      summary: Récupérer un item aléatoire
      tags:
        - Items
      responses:
        '200':
          description: Détails d'un item aléatoire
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '500':
          description: Erreur interne du serveur

  # === MOB SERVICE ENDPOINTS ===
  /api/mobs:
    
    get:
      summary: Récupérer tous les types de mobs
      tags:
        - Mobs
      responses:
        '200':
          description: Liste des types de mobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MobType'
        '500':
          description: Erreur interne du serveur

  /api/mobs/type/{mobType}:
    get:
      summary: Récupérer tout les mob d'un type
      tags:
        - Mobs
      parameters:
        - name: mobType
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: liste de mob d'un type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mob'
        '404':
          description: Type de mob non trouvé
        '500':
          description: Erreur interne du serveur

  /api/mobs/{mobId}:
    get:
      summary: Récupérer un mob par son ID
      tags:
        - Mobs
      parameters:
        - name: mobId
          in: path
          required: true
          schema:
            type: number
      responses:
        '200':
          description: Détails du mob
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mob'
        '404':
          description: Mob non trouvé
        '500':
          description: Erreur interne du serveur

  # === GAME ENGINE ENDPOINTS ===
  /api/game/start:
    post:
      summary: Démarrer une nouvelle partie
      tags:
        - Game
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - heroId
                - dungeonId
              properties:
                heroId:
                  type: integer
                dungeonId:
                  type: string
                  format: uuid
      responses:
        '201':
          description: Partie créée avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '400':
          description: Requête invalide
        '500':
          description: Erreur interne du serveur
  /api/game:
    post:
      summary: Démarrer une nouvelle partie
      tags:
        - Game
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - heroId
                - dungeonId
              properties:
                heroId:
                  type: integer
                dungeonId:
                  type: string
                  format: uuid
      responses:
        '201':
          description: Partie créée avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '400':
          description: Requête invalide
        '500':
          description: Erreur interne du serveur

    get:
      summary: Récupérer l'état actuel de la partie
      tags:
        - Game
      responses:
        '200':
          description: État actuel de la partie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '404':
          description: Aucune partie en cours
        '500':
          description: Erreur interne du serveur

    put:
      summary: Mettre à jour l'état de la partie
      tags:
        - Game
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Game'
      responses:
        '200':
          description: État de la partie mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '400':
          description: Requête invalide
        '404':
          description: Partie non trouvée
        '500':
          description: Erreur interne du serveur

    delete:
      summary: Terminer la partie en cours
      tags:
        - Game
      responses:
        '204':
          description: Partie terminée avec succès
        '404':
          description: Aucune partie en cours
        '500':
          description: Erreur interne du serveur

  /api/hero/{heroId}/move:
    put:
      summary: Déplacer un héros à une nouvelle position
      tags:
        - Game
      parameters:
        - name: heroId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - position
              properties:
                position:
                  $ref: '#/components/schemas/Position'
      responses:
        '200':
          description: Héros déplacé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  newPosition:
                    $ref: '#/components/schemas/Position'
                  events:
                    type: array
                    items:
                      type: string
        '400':
          description: Mouvement invalide
        '404':
          description: Héros non trouvé
        '500':
          description: Erreur interne du serveur

  /api/fight:
    post:
      summary: Initier un combat entre héros et ennemis
      tags:
        - Game
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - heroId
                - mobIds
              properties:
                heroId:
                  type: integer
                mobIds:
                  type: array
                  items:
                    type: integer
      responses:
        '201':
          description: Combat initié
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '400':
          description: Paramètres de combat invalides
        '500':
          description: Erreur interne du serveur

    get:
      summary: Récupérer l'état actuel du combat
      tags:
        - Game
      responses:
        '200':
          description: État actuel du combat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '404':
          description: Aucun combat en cours
        '500':
          description: Erreur interne du serveur

    put:
      summary: Mettre à jour l'état du combat
      tags:
        - Game
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [attack, defend, useItem, flee]
                targetId:
                  type: integer
                itemId:
                  type: integer
      responses:
        '200':
          description: Action de combat exécutée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '400':
          description: Action invalide
        '404':
          description: Combat non trouvé
        '500':
          description: Erreur interne du serveur

    delete:
      summary: Terminer le combat en cours
      tags:
        - Game
      responses:
        '204':
          description: Combat terminé
        '404':
          description: Aucun combat en cours
        '500':
          description: Erreur interne du serveur
  /api/fight/{fightId}/attack:
    post:
      summary: Effectuer une attaque dans le combat en cours
      tags:
        - Game
      parameters:
        - name: fightId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetId
              properties:
                targetId:
                  type: integer
      responses:
        '200':
          description: Attaque effectuée avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '400':
          description: Attaque invalide
        '404':
          description: Combat non trouvé
        '500':
          description: Erreur interne du serveur
  /api/fight/{fightId}/flee:
    post:
      summary: Tenter de fuir le combat en cours
      tags:
        - Game
      parameters:
        - name: fightId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Fuite réussie ou échouée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '400':
          description: Fuite invalide
        '404':
          description: Combat non trouvé
        '500':
          description: Erreur interne du serveur
  /api/fight/{fightId}/defend:
    post:
      summary: Défendre dans le combat en cours
      tags:
        - Game
      parameters:
        - name: fightId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Défense effectuée avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Fight'
        '400':
          description: Défense invalide
        '404':
          description: Combat non trouvé
        '500':
          description: Erreur interne du serveur
  /api/dungeon:
    post:
      summary: Créer un nouveau donjon
      tags:
        - Dungeons
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DungeonCreate'
      responses:
        '201':
          description: Donjon créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dungeon'
        '400':
          description: Données invalides
        '500':
          description: Erreur interne du serveur
  api/dungeon/{dungeonId}:
    get:
      summary: Récupérer un donjon par son ID
      tags:
        - Dungeons
      parameters:
        - name: dungeonId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Détails du donjon
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dungeon'
        '404':
          description: Donjon non trouvé
        '500':
          description: Erreur interne du serveur
  /api/mob/{mobId}:
    get:
      summary: Récupérer un mob par son ID
      tags:
        - Mobs
      parameters:
        - name: mobId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Détails du mob
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mob'
        '404':
          description: Mob non trouvé
        '500':
          description: Erreur interne du serveur
    put:
      summary: Mettre à jour un mob par son ID
      tags:
        - Mobs
      parameters:
        - name: mobId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MobUpdate'
      responses:
        '200':
          description: Mob mis à jour avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mob'
        '400':
          description: Données invalides
        '404':
          description: Mob non trouvé
        '500':
          description: Erreur interne du serveur
    delete:
      summary: Supprimer un mob par son ID
      tags:
        - Mobs
      parameters:
        - name: mobId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Mob supprimé avec succès
        '404':
          description: Mob non trouvé
        '500':
          description: Erreur interne du serveur
  /api/mob:
    get:
      summary: Récupérer tous les types de mobs
      tags:
        - Mobs
      responses:
        '200':
          description: Liste des types de mobs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MobType'
        '500':
          description: Erreur interne du serveur
    post:
      summary: Créer un nouveau type de mob
      tags:
        - Mobs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MobCreate'
      responses:
        '201':
          description: Type de mob créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MobType'
        '400':
          description: Données invalides
        '500':
          description: Erreur interne du serveur
    delete:
      summary: Supprimer un type de mob par son ID
      tags:
        - Mobs
      parameters:
        - name: mobTypeId
          in: query
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Type de mob supprimé avec succès
        '404':
          description: Type de mob non trouvé
        '500':
          description: Erreur interne du serveur
    /api/items:
      post:
        summary: Créer un nouveau type d'item
        tags:
          - Items
        requestBody:
          required: true
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemCreate'
        responses:
          '201':
            description: Type d'item créé avec succès
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Item'
          '400':
            description: Données invalides
          '500':
            description: Erreur interne du serveur
    /api/items/{itemId}:
      delete:
        summary: Supprimer un type d'item par son ID
        tags:
          - Items
        parameters:
          - name: itemId
            in: path
            required: true
            schema:
              type: string
              format: uuid
        responses:
          '204':
            description: Type d'item supprimé avec succès
          '404':
            description: Type d'item non trouvé
          '500':
            description: Erreur interne du serveur


components:
  schemas:
    Hero:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        healthPoints:
          type: integer
        healthPointsMax:
          type: integer
        level:
          type: integer
        attackPoints:
          type: integer
        inventory:
          type: array
          items:
            $ref: '#/components/schemas/HeroItem'
        class:
          type: string
        gold:
          type: integer
    HeroItem:
      type: object
      properties:
        id:
          type: integer
        quantity:
          type: integer
    CreateHeroRequest:
      type: object
      properties:
        name:
          type: string
        class:
          $ref: '#/components/schemas/Class'
    Class:
      type: object
      properties:
        name:
          type: string
        healthPoints:
          type: integer
        attackPoints:
          type: integer
    Mob:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        healthPoints:
          type: integer
        healthPointsMax:
          type: integer
        attackPoints:
          type: integer
        type:
          type: string
          enum: [Common, Boss]
    Item:
      type: object
      properties:
        uuid:
          type: string
        name:
          type: string
        effect:
          type: string
          enum: [Attack, Heal, HealthPointMax]
        value:
          type: integer
        description:
          type: string
        rarity:
          type: string
          enum: [Common, Rare, Epic, Legendary]
        itemType:
          type: string
          enum: [Weapon, Consumable, Armor]
    Dungeon:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        rooms:
          type: array
          items:
            $ref: '#/components/schemas/Room'
        createdAt:
          type: string
          format: date-time
    Room:
      type: object
      properties:
        id:
          type: string
        dimension:
          $ref: '#/components/schemas/Dimension'
        entrance:
          $ref: '#/components/schemas/Position'
        exit:
          $ref: '#/components/schemas/Position'
        order:
          type: integer
        description:
          type: string
    Dimension:
      type: object
      properties:
        width:
          type: integer
        height:
          type: integer
    Position:
      type: object
      properties:
        x:
          type: integer
        y:
          type: integer
    Fight:
      type: object
      properties:
        id:
          type: string
        heroId:
          type: string
        mobIds:
          type: array
          items:
            type: integer
        status:
          type: string
          enum: [active, heroWon, heroLost, fled]
        turn:
          type: string
          enum: [hero, mobs]
        turnNumber:
          type: integer
        actions:
          type: array
          items:
            $ref: '#/components/schemas/FightAction'
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
    FightAction:
      type: object
      properties:
        turn:
          type: integer
        actor:
          type: string
        action:
          type: string
        target:
          type: string
        damage:
          type: integer
        result:
          type: string
    Game:
      type: object
      properties:
        id:
          type: string
        heroId:
          type: string
        dungeonId:
          type: string
        currentRoomId:
          type: string
        heroPosition:
          $ref: '#/components/schemas/Position'
        currentFightId:
          type: string
        currentFight:
          $ref: '#/components/schemas/Fight'
        status:
          type: string
          enum: [active, paused, completed, failed]
        startTime:
          type: string
          format: date-time
        lastUpdate:
          type: string
          format: date-time
        score:
          type: integer
        mobs:
          type: array
          items:
            $ref: '#/components/schemas/Mob'
        items:
          type: array
          items:
            $ref: '#/components/schemas/Item'

tags:
  - name: Heroes
    description: Gestion des héros
  - name: Dungeons
    description: Gestion des donjons
  - name: Items
    description: Gestion des objets et équipements
  - name: Mobs
    description: Gestion des ennemis
  - name: Game
    description: Logique de jeu et combats
  - name: Logs
    description: Système de logs et événements