openapi: 3.0.0
info:
  title: Item Service API
  description: API de gestion du catalogue d'items pour le microservice Héros.
  version: 1.0.0
servers:
  - url: http://localhost:3004
paths:
  /api/items:
    post:
      summary: Créer un nouveau type d'item
      tags:
        - Items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemTypeCreate'
      responses:
        '201':
          description: Type d'item créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemType'
        '400':
          description: Données invalides
        '500':
          description: Erreur interne du serveur

    get:
      summary: Récupérer tous les types d'items
      tags:
        - Items
      responses:
        '200':
          description: Liste des types d'items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ItemType'
        '500':
          description: Erreur interne du serveur

  /api/items/{itemTypeId}:
    get:
      summary: Récupérer un type d'item par son ID
      tags:
        - Items
      parameters:
        - name: itemTypeId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Détails du type d'item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemType'
        '404':
          description: Type d'item non trouvé
        '500':
          description: Erreur interne du serveur

    put:
      summary: Mettre à jour un type d'item
      tags:
        - Items
      parameters:
        - name: itemTypeId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemTypeUpdate'
      responses:
        '200':
          description: Type d'item mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemType'
        '400':
          description: Données invalides
        '404':
          description: Type d'item non trouvé
        '500':
          description: Erreur interne du serveur

    delete:
      summary: Supprimer un type d'item
      tags:
        - Items
      parameters:
        - name: itemTypeId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Type d'item supprimé avec succès
        '404':
          description: Type d'item non trouvé
        '500':
          description: Erreur interne du serveur

  /api/items/generate:
    post:
      summary: Générer un item aléatoire
      tags:
        - Items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rarity:
                  type: string
                  enum: [Commun, Rare, Epic, Legendaire]
                itemTypeId:
                  type: integer
                position:
                  $ref: '#/components/schemas/Position'
                roomId:
                  type: string
                  format: uuid
      responses:
        '201':
          description: Item généré avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '400':
          description: Paramètres invalides
        '500':
          description: Erreur interne du serveur

components:
  schemas:
    ItemCategory:
      type: object
      required: [uuid, nom]
      properties:
        uuid:
          type: string
          format: uuid
          readOnly: true
        nom:
          type: string
          example: "Arme"

    BaseItem:
      type: object
      required: [nom, rarete, type]
      properties:
        uuid:
          type: string
          format: uuid
          readOnly: true
        nom:
          type: string
          example: "Lame de l'Exilé"
        rarete:
          type: string
          enum: [Commun, Rare, Epic, Legendaire]
          default: Commun
        type:
          $ref: "#/components/schemas/ItemCategory"

    ItemWithEffect:
      allOf:
        - $ref: "#/components/schemas/BaseItem"
        - type: object
          properties:
            description:
              type: string
              example: "Une épée dont la lame semble palpiter de chaleur."
            effets:
              type: array
              items:
                $ref: "#/components/schemas/Effect"
    
    ItemType:
       type: object
       required: [id, nom, categorie]
       properties:
         id:
           type: integer
           readOnly: true
         nom:
           type: string
           example: "Épée Longue"
         description:
           type: string
           example: "Une arme à deux mains puissante"
         categorie:
           $ref: "#/components/schemas/ItemCategory"
         effets:
           type: array
           items:
             $ref: "#/components/schemas/Effect"
         rarete:
           type: string
           enum: [Commun, Rare, Epic, Legendaire]
           default: Commun

    ItemTypeCreate:
      type: object
      required: [nom, categorieUuid]
      properties:
        nom:
          type: string
          example: "Épée Longue"
        description:
          type: string
          example: "Une arme à deux mains puissante"
        categorieUuid:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        effets:
          type: array
          items:
            $ref: "#/components/schemas/Effect"
        rarete:
          type: string
          enum: [Commun, Rare, Epic, Legendaire]
          default: Commun

    ItemTypeUpdate:
      type: object
      properties:
        nom:
          type: string
          example: "Épée Longue"
        description:
          type: string
          example: "Une arme à deux mains puissante"
        categorieUuid:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        effets:
          type: array
          items:
            $ref: "#/components/schemas/Effect"
        rarete:
          type: string
          enum: [Commun, Rare, Epic, Legendaire]

    Item:
      type: object
      required: [uuid, itemType]
      properties:
        uuid:
          type: string
          format: uuid
          readOnly: true
        itemType:
          $ref: "#/components/schemas/ItemType"
        position:
          $ref: "#/components/schemas/Position"
        roomId:
          type: string
          format: uuid
        rarete:
          type: string
          enum: [Commun, Rare, Epic, Legendaire]
          default: Commun
    
    Position:
      type: object
      required: [x, y]
      properties:
        x:
          type: number
          format: float
          example: 10.5
        y:
          type: number
          format: float
          example: 20.3

    Effect:
      type: object
      required: [caracteristique, valeur]
      properties:
        caracteristique:
          type: string
          enum: [Force, Agilite, Intelligence, PointsDeVie]
        valeur:
          type: integer
          example: 15

    Error:
      type: object
      properties:
        message:
          type: string
        code:
          type: integer

  responses:
    Error400:
      description: Requête malformée
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    Error404:
      description: Item non trouvé
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    Error500:
      description: Erreur interne
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

tags:
  - name: Items
    description: Gestion des types d'items (catalogue)